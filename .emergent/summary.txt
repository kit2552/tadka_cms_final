<analysis>**original_problem_statement:**
The initial feature request was to create a Photo Gallery Agent that could scrape images from websites, create a gallery, and generate a new article post linking to it. This evolved into a second, more specific agent type called the Tadka Pics Agent.

**Tadka Pics Agent Requirements:**
1.  **Source Options:** The agent must support two sources: Websites (functioning like the Photo Gallery Agent) and Instagram.
2.  **Instagram Scraping:** When Instagram is selected, the user will provide public Instagram post/reel embed code. The agent must parse this code to download all images or video thumbnails from the post without requiring a login.
3.  **Simplified Form:** The agent form should hide most fields (content type, category, word count, etc.). Enable Tadka Pics should be on and disabled by default.
4.  **No Article Creation:** Unlike other agents, this agent's sole purpose is to create an image gallery. It should **not** generate or create an associated article/post.
5.  **Artist Name Extraction:** The agent must automatically extract the artist/celebrity's full name (e.g., Pragya Jaiswal) from the Instagram post to name the gallery correctly.

**User's preferred language**: English

**what currently exists?**
The Tadka application is a full-stack News CMS with a multi-agent AI system.
-   **Backend**: Features three distinct agent services:
    -   : For standard article posts.
    -   : For creating photo galleries and an accompanying article. This service includes robust web scraping with image deduplication, placeholder filtering, and S3 upload logic.
    -   : A new service for the Tadka Pics Agent, designed to create galleries from websites or Instagram without creating an article.
-   **Frontend**: The React UI features a highly dynamic  component that conditionally renders different fields based on the selected agent type (, , or ).
-   **Completed Work:** A significant number of features and bug fixes were completed, including implementing the Photo Gallery agent, fixing YouTube video post creation, resolving content type mismatches, and moving prompt management to a central settings page.

**Last working item**:
-   Last item agent was working: Implementing the Tadka Pics Agent. The final action was to fix the logic in  to correctly extract the artist's full name (e.g., Pragya Jaiswal) from an Instagram embed code, rather than just their username ().
-   Status: **IN PROGRESS**
-   Agent Testing Done: N
-   Which testing method agent to use? **both**.
    -   **Backend:** Use the backend testing agent to run the Tadka Pics agent with an Instagram URL. Verify that it extracts the correct full name, downloads all images, creates a gallery with Tadka Pics enabled, and does **not** create a post.
    -   **Frontend:** Manually test the Tadka Pics Agent form to ensure all UI rules (hidden fields, default settings) are applied correctly.
-   User Testing Done: N

**All Pending/In progress Issue list**:
-   None. The primary focus is completing the in-progress task.

**In progress Task List**:
-   **Task 1: Complete and test the Tadka Pics Agent implementation (P0)**
    -   **Where to resume:** The agent has just applied a fix to the artist name extraction logic in . The immediate next step is to restart the backend and test the entire feature.
    -   **What will be achieved with this?** A new, streamlined agent type that allows for the rapid creation of Tadka Pics image galleries directly from Instagram posts or websites.
    -   **Status:** IN PROGRESS
    -   **Should Test frontend/backend/both after fix?** Both
    -   **Blocked on something:** None

**Upcoming and Future Tasks**
-   **Upcoming Tasks:**
    -   **(P1)** Implement the Review Agent form and backend logic, which is visible as an option in the UI but not yet functional.
-   **Future Tasks:**
    -   **(P2)** Refactor : This component has grown very complex with logic for three different agent types and should be broken into smaller, more manageable child components.
    -   **(P2)** Refactor scraping logic: Abstract the common web scraping, image downloading, and gallery creation logic from  and  into a shared utility or base class.

**Completed work in this session**
-   **Feature:** Implemented the Photo Gallery Agent with sophisticated web scraping to find the latest gallery on a page, download images, filter out placeholders/ads, handle duplicates, upload to S3, and create a new gallery and article.
-   **Feature:** Implemented Video Post auto-detection, which identifies YouTube links in scraped content and sets the content type correctly.
-   **Feature:** Added a Custom Prompt editor to the agent form, allowing per-agent prompt overrides.
-   **Refactor:** Migrated the Category-Prompt Mapping feature from the agent form into the main System Settings page for better management.
-   **Bug Fix:** Resolved a critical bug where the State News agent was generating content from a listing page summary instead of the actual latest article.
-   **Bug Fix:** Fixed numerous routing and display issues related to the Video Post content type to ensure it used the correct article template.
-   **Bug Fix:** Corrected S3 upload failures in the gallery agent by using the globally initialized S3 service.
-   **Bug Fix:** Resolved multiple scraping issues in the Photo Gallery agent, including duplicate images, incorrect latest gallery detection, and scraping images from unrelated related galleries sections.

**Earlier issues found/mentioned but not fixed**
-   None.

**Known issue recurrence from previous fork**
-   None.

**Code Architecture**


**Key Technical Concepts**
-   **Frontend:** React, Tailwind CSS
-   **Backend:** FastAPI (Python)
-   **Database:** MongoDB
-   **Web Scraping:** Advanced use of  and  for parsing complex news sites and Instagram embed pages, including DOM traversal to isolate main content and avoid ads/related links.
-   **Multi-Agent Architecture:** Backend is structured with separate, specialized services for different agent types (, , ).
-   **Dynamic UI:** The main agent form () uses conditional rendering to present a different user interface for each of the three agent types.

**key DB schema**
-   **ai_agents (collection):** Schema is now highly flexible, supporting different fields based on . It includes , gallery settings, and a new  field for the Tadka Pics agent.
-   **galleries (collection):** Created automatically by the  and .

**changes in tech stack**
-   No new dependencies were added, but the use of  was extended for more advanced web scraping tasks.

**All files of reference**
-   **/app/backend/services/tadka_pics_agent_service.py:** The new service for the current in-progress feature. **Primary file to work on.**
-   **/app/frontend/src/components/PostAgentForm.jsx:** A critical, heavily modified file that controls the UI for all agent types.
-   **/app/backend/services/gallery_agent_service.py:** The service for the Photo Gallery agent, containing logic that is being adapted for the Tadka Pics agent.
-   **/app/backend/routes/ai_agents_routes.py:** The API router, updated to delegate to the correct agent service based on .
-   **/app/frontend/src/pages/AIAgents.jsx:** Modified to correctly launch the form for all agent types.

**Areas that need refactoring**:
-    is now extremely complex due to handling three agent types with extensive conditional logic. It should be broken down into smaller, agent-specific components to improve readability and maintainability.
-   The web scraping and image processing logic is duplicated across  and . This should be extracted into a common utility module or a base class.

**key api endpoints**
-   : The primary endpoint to trigger any agent. The backend now routes the request to the appropriate service based on the agent's type.

**Critical Info for New Agent**
-   **TOP PRIORITY (P0):** Complete the implementation of the Tadka Pics Agent. You are resuming mid-feature.
-   **CURRENT STATE:** The UI and backend service for the Tadka Pics agent are created. A bug fix for extracting the artist's full name from Instagram embeds was just applied to  but has not been tested.
-   **IMMEDIATE NEXT STEPS:**
    1.  Restart the backend service to deploy the latest fix.
    2.  Test the Tadka Pics Agent using the Instagram source.
    3.  Verify that the agent correctly extracts the full artist name, downloads all images from the post, creates a new gallery with Tadka Pics enabled, and confirms that **NO** article/post is created.
    4.  Also test the Website source option to ensure it functions correctly.
-   **COMPLEXITY WARNING:** The  component is very fragile due to its complexity. Be cautious when making changes to it and test all three agent forms to prevent regressions.

**documents created in this job**
-   None.

**Last 10 User Messages and any pending user messages**
1.  **User:** I want a Tadka Pics Agent that's like the photo gallery agent but simpler. It should only create a gallery (not a post) and have an option to scrape from Instagram. (Completed: Agent started implementation)
2.  **User:** We'll use the Instagram embed option. Can you download all images and support reels? (Completed: Agent confirmed this is possible)
3.  **User:** Here is a sample Instagram embed code for testing. (Completed: Agent tested and confirmed image extraction works)
4.  **User:** You will extract the actor's name from Instagram to create the gallery, right? (Pending: Agent just implemented a fix for this)
5.  **Agent:** Yes, extracting the artist name. The current code extracts the username (), but it should be the full name (Pragya Jaiswal). Let me fix that. (Completed: Agent applied the fix)

**Project Health Check:**
-   **Broken:** The Tadka Pics Agent feature is mid-implementation and is not yet fully functional or tested.
-   **Mocked:** None.

**3rd Party Integrations**
-   **OpenAI, Google Gemini, Anthropic:** Used for text generation. Requires User API Key.
-   **Trafilatura & BeautifulSoup4:** Used for web scraping article and gallery content from websites.
-   **Instagram:** Used via public embed URLs to scrape images and metadata without authentication. No key required.

**Testing status**
-   **Testing agent used after significant changes:** NO (for the Tadka Pics agent)
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** None
-   **Known regressions:** None.

**Credentials to test flow:**
-   None required. The agent should use the provided Instagram embed code for testing.

**What agent forgot to execute**
-   The agent applied a fix to the Instagram name extraction logic in  but has not yet restarted the backend service to deploy the change or tested if the fix works as intended.</analysis>
